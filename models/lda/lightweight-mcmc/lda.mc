include "string.mc"
include "seq.mc"
mexpr
-- let thetas = [
--[0.532646379515,0.000680808604114,0.454550601545,0.00355827293462,2.05450736338e-15,4.30392665976e-09,0.00117794871987,0.00716226557952,1.34548679705e-12,0.000223718796322,]
--[0.00476101637211,0.333763041099,0.150841006495,0.507526692633,9.11172504884e-08,1.22861914814e-11,1.15227894289e-05,0.00244305470074,0.000637596449269,1.59783317168e-05,]
--[0.000100675530722,8.16959047361e-24,1.31794361645e-07,8.90471758189e-11,1.07635779817e-08,1.16518039311e-06,1.08736612157e-05,0.99808664183,0.00176789466321,3.26064871251e-05,]
--[8.80927779732e-05,0.00158540841292,0.885458531058,0.0406709419864,3.5693463049e-05,0.0456805848322,0.0127352805818,0.0123057818026,0.00141413048908,2.55545958506e-05,]
--[2.96841834673e-09,5.5362286814e-14,0.0272164656485,0.236670624593,2.87349201677e-05,1.57717256339e-08,0.00357743352443,4.83735721209e-05,0.732452871625,5.47737726245e-06,]
--[0.0457233728529,0.00018195256431,0.000331667138056,1.03448865694e-06,0.036681477092,0.0386498661611,0.440041722827,0.388319548634,0.0500630718652,6.28637649995e-06,]
--[2.12067698584e-05,0.00119128765184,8.63990549766e-06,9.13934349098e-06,0.01385636795,0.00106494644299,0.00266283941837,0.954577460057,0.0266081124567,4.04389586135e-12,]
--[0.00232753223391,0.000117178135078,0.000690890056064,0.000724507919239,9.71524510814e-05,0.000129590767397,0.00526754532086,4.3239009466e-05,0.990602364107,3.21119753113e-13,]
--[0.201854397646,0.000146705028365,0.000702071702673,0.000224740217025,9.66233801597e-05,0.764432883815,0.000901666254205,0.00178798125128,6.34543296954e-07,0.0298522961626,]
--[0.00170411947747,0.0963273198202,1.06026145028e-07,0.268940332694,8.76532816466e-05,0.632769985001,2.65221628648e-13,6.35250440345e-09,5.842835075e-08,0.000170418918009,]
--[0.565752420848,3.64398842737e-10,4.25962842232e-07,0.0008709518531,3.356374096e-06,0.00210554258456,1.32224396652e-05,0.0072021747031,0.424051765957,1.38912761286e-07,]
--[5.97456594797e-05,0.000701009891565,3.3260538699e-05,0.0122595462264,0.00497129356203,4.76180468978e-08,4.85492410312e-05,0.95570240602,0.00050526001969,0.0257188812234,]
--[0.0354456024674,9.97493720917e-07,0.00670856353808,0.598866935071,0.348686814333,2.62919784522e-10,5.24513797401e-07,6.2555216969e-08,0.0102904997652,9.89584313603e-16,]
--[0.0611803100591,0.376657289165,0.00101996751493,0.0109952381146,0.0257687645134,1.9485745019e-08,0.518153726317,0.00334195422972,1.25339514191e-08,0.00288271806589,]
--[0.945695843263,0.000773301635567,0.00163704348353,6.14181638887e-19,0.0020607289604,1.54545902244e-05,0.0431812927368,2.7058179645e-06,0.0066029913071,3.06382054401e-05,]
--[3.7051556346e-08,0.000203308056113,0.343055714967,2.09520591786e-06,0.00617274070649,1.2534657975e-07,4.01355148323e-11,2.86761281323e-05,0.602983359549,0.0475539429493,]
--[3.57381733982e-10,0.0165351122212,0.000983109653125,5.92653349222e-07,0.810594280114,0.113791392732,2.82947194176e-15,9.76276642295e-06,0.0559180373421,0.00216771215977,]
--[7.40485952055e-05,0.0395481418499,0.286369411657,0.050594769249,1.14627636357e-20,0.00316639288217,0.420748696401,0.0128402738372,0.109469051942,0.0771892135868,]
--[0.00593316100338,0.00811998882157,8.00349784307e-15,0.039031863783,1.56178891568e-05,0.00502429320621,2.69687235784e-18,8.97346805067e-05,0.154555150418,0.787230190198,]
--[0.000106070360604,1.17029812692e-06,3.03250633134e-11,0.356119021899,1.74614996718e-08,2.07782213089e-05,0.284142123702,0.00138876760305,0.000998867786177,0.357223182637,]
--[0.16982677804,9.26244000275e-11,0.541556862967,0.000905980434508,0.0295748085959,0.128280366493,0.100438192674,1.60961130628e-05,0.0289402004228,0.000460714166794,]
--[7.3722455591e-19,0.201100010152,0.000244300467572,0.428775480032,0.000192080545972,0.139872529056,0.0450257314431,0.0123228505491,4.32277845138e-14,0.172467017755,]
--[1.90303238323e-33,1.12192951637e-14,0.943691719985,5.21002357677e-07,0.0273544453266,0.0276879210896,3.89589725037e-14,2.1648955575e-07,0.00126468292775,4.93178796592e-07,]
--[0.00364713485023,0.233687765196,2.88275054497e-08,0.0241936748716,0.00343971561502,0.729619926675,3.17472142867e-09,2.75297422655e-07,1.99274542765e-06,0.00540948274713,]
--[0.00140039869657,2.42391911814e-05,0.0779350236386,0.848501616138,1.75603709997e-05,1.76928822704e-06,0.046851995977,0.0252673384604,5.82379693784e-08,1.49323962322e-12,]
--]
-- let phis = [
--[0.00409805565661,0.0041488185024,1.73924355885e-07,0.0346317668639,4.49668333381e-06,0.0995466620451,0.0266644824884,0.208075428514,0.00198451733352,2.78602525444e-05,1.01308648008e-05,0.0995987289806,2.08005828477e-09,6.62313692078e-07,3.76375750431e-14,0.000338173981388,7.12945681769e-07,0.400024072178,7.91862708626e-06,7.87246261888e-06,0.000490393693962,0.0170308518077,0.00111084604775,0.00569193950586,0.0614617484509,1.2046425332e-15,0.0165109736289,2.29205002745e-05,0.0185096509026,1.38763938107e-07,]
--[0.000107386428984,5.30906814133e-06,0.000353511294257,1.52604908609e-10,1.7237524612e-05,1.12595593315e-07,0.000234735277492,0.00127951702446,1.69127791771e-12,0.766139575059,1.10091190208e-07,0.0116798982599,3.83210298848e-09,0.0366624947858,0.0686974345177,0.0348727286855,6.60923080389e-05,5.07210146549e-05,0.00166415680612,0.0164514409682,7.20665103459e-05,0.00095494510062,1.21008438178e-07,0.0510640289826,1.41235462181e-06,2.54237863468e-07,0.00952750310823,1.64839315375e-07,9.70381623241e-05,1.33477031284e-15,]
--[0.00150036446914,8.10596819621e-22,6.73437119378e-05,0.0524540638807,2.15345966734e-13,7.35669027168e-11,0.382996186715,0.142033820137,6.4182698633e-16,1.00145103971e-07,0.00150873800056,3.69265531831e-08,0.0302890434688,0.000554921527734,0.0298811415503,0.000693489518981,0.065486761085,1.03041774826e-36,1.50809244e-06,0.156007896132,0.072720713935,1.68787020659e-09,4.69148465298e-12,7.83812067742e-07,0.000446042138336,0.000762564327511,6.29170880794e-05,0.0238708065871,0.0386607549847,4.77430942806e-22,]
--[0.00424439804924,0.00693819695219,4.22592507079e-16,0.00214733554359,0.000990937234295,0.224671674953,0.00251555175977,0.0444121627264,4.11125087193e-10,7.30907414981e-07,3.30221348773e-09,0.256823384028,0.00778803329002,0.00319763304726,0.00134336392075,0.304401452659,0.0474551206729,1.63802566224e-07,0.00488012961236,0.014437953432,0.0374942825522,1.71020505819e-12,0.000690468324901,0.0355548867276,2.6178722684e-07,1.59703415226e-08,6.19822164048e-08,9.33302519159e-09,6.11784404671e-16,1.17870166502e-05,]
--[0.0475020774613,0.000234946028571,2.66193506392e-05,0.00313140531656,0.144425759794,0.00389750852335,2.9307509838e-07,0.00808589789396,2.51263145225e-12,1.35920579719e-10,2.0169137791e-06,0.000115876020868,0.00380612463517,3.45413455935e-06,0.316552617558,2.32064000796e-07,0.348407052385,0.0206607914045,0.000798246111732,3.83534439129e-14,0.0786185737201,2.68761363654e-05,0.00351767505464,0.000262464846257,0.00162787157154,0.00177332871492,2.8876728837e-08,0.00474420741017,0.000634373165746,0.0111436816951,]
--[3.5951757912e-22,1.90358999675e-08,4.33576108305e-08,0.00806438319129,7.09490432595e-07,0.00589357702012,7.02114580943e-11,0.0704126828757,0.00233149480749,0.0116184374903,0.000139613456633,0.133509393759,0.000322190840411,0.0957307251328,0.00934723561537,8.18820304024e-09,0.000678406888364,2.90417517686e-13,0.00059814189337,0.00990199582518,0.00031181262798,0.00249800358664,0.0127308567169,1.59296432396e-06,0.0047010869158,1.12876735766e-15,0.0259818062319,0.002400216359,0.0476260809397,0.555199484719,]
--[6.89895711417e-09,3.045317857e-10,7.64379018623e-12,2.21469382267e-06,0.00180181314505,3.91300631883e-05,0.000665387264616,4.24569242742e-10,0.104758689053,1.43537539208e-08,0.452449057439,4.06711347631e-07,0.000477778956371,1.56899297349e-05,3.46922089656e-06,9.42422574198e-08,1.31549495087e-07,0.000972455194092,1.68869380001e-08,0.148987697575,8.99722967346e-12,5.81866426411e-07,1.01561676953e-11,2.47151914173e-05,1.38771993621e-05,0.00200906604114,5.89273652838e-07,0.101971902731,7.93012079626e-07,0.185804420752,]
--[3.7307719299e-24,3.42061311848e-18,0.00245743125832,1.33080124646e-10,1.85909555007e-05,0.000824415997616,0.000240242449142,5.69969254623e-06,0.170940334216,1.6120402965e-05,0.00997118626474,7.25669797347e-05,0.00214026749578,0.00560978848892,0.00537551445732,0.254993804664,3.35475880569e-06,0.00143430305006,4.55204082509e-08,0.0397088412402,1.84591767076e-05,0.0494305491275,7.27268530296e-08,0.0367308881377,1.19829631761e-08,0.00286901553219,0.0627361617487,3.53237325913e-08,0.351174402482,0.00322789573683,]
--[0.000196086746687,0.00136213285485,5.42838876493e-05,0.0728377264963,0.0110091747397,0.000527241437328,1.33673730607e-06,1.44731638698e-07,5.19731294323e-10,0.207297340408,0.00105160197411,1.61465441455e-11,0.250027788309,3.37563231945e-08,0.00359114193402,0.0786608308413,0.100972817268,0.0371574057289,2.8205088208e-09,0.00115499821904,0.0172654055583,0.0737191271109,2.9999341255e-05,3.2017667251e-06,8.00395697692e-07,3.44424549802e-07,0.140404101567,0.00245205488112,0.000222875527814,4.2030132108e-16,]
--[3.54911507959e-06,0.00233942088145,3.68679306393e-06,5.06407782533e-09,0.0881312450537,9.91815994978e-11,0.188467857162,5.6581047697e-08,0.164164596549,0.00547778113859,4.45729453749e-05,0.00534456008528,1.00937679036e-05,0.00470736592646,2.06019713263e-12,0.0111028725775,1.34707532551e-07,0.224845412367,4.61580124822e-08,0.0319781920254,0.00699147760094,0.0455735171346,0.15732619759,2.19623393057e-07,1.54580641125e-06,0.0033695843622,0.0543228315732,0.00576501389592,8.01910801835e-06,2.01443058012e-05,]
--]
let vocabsize:Int = 30 in
let numdocs:Int = 25 in
let numtopics:Int = 10 in
let alpha:[Float] = [0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1] in
let beta:[Float] = [0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1] in
let phi = map (lam. assume (Dirichlet beta)) (range 0 numtopics 1) in
let theta = map (lam. assume (Dirichlet alpha)) (range 0 numdocs 1) in
let oneHotEncoding = lam size. lam ind. lam count.
mapi (lam i. lam e. if eqi i ind then count else 0) (range 0 size 1) in
let docs:[(Int,Int)] = [(6,4),(7,1),(17,2),(19,1),(21,1),(27,1),(6,3),(9,3),(14,1),(15,2),(16,1),(8,3),(15,4),(28,3),(6,3),(10,1),(15,1),(16,1),(19,1),(20,1),(28,1),(29,1),(9,4),(11,1),(12,1),(15,1),(21,1),(26,2),(8,3),(10,3),(25,1),(28,1),(29,2),(8,1),(12,1),(13,2),(15,1),(16,1),(17,1),(21,1),(28,2),(3,1),(9,2),(12,1),(15,1),(16,2),(21,1),(26,2),(3,2),(11,1),(17,1),(26,1),(29,5),(7,1),(11,3),(13,1),(23,1),(29,4),(7,1),(8,1),(12,1),(15,1),(17,4),(20,1),(23,1),(13,2),(15,4),(26,1),(28,3),(11,1),(14,2),(15,5),(16,2),(8,2),(9,3),(10,2),(27,1),(29,2),(7,2),(11,1),(17,6),(26,1),(6,2),(9,3),(12,1),(17,1),(19,2),(26,1),(0,1),(4,1),(5,1),(16,6),(29,1),(6,4),(10,2),(12,1),(27,2),(28,1),(4,2),(6,2),(8,2),(12,1),(15,1),(17,1),(26,1),(6,1),(8,1),(11,3),(15,2),(16,1),(21,2),(3,1),(7,2),(14,1),(17,2),(19,1),(20,1),(29,2),(6,1),(9,1),(10,1),(11,1),(15,2),(17,2),(21,1),(29,1),(3,1),(6,3),(7,1),(16,1),(19,2),(20,1),(28,1),(11,4),(13,1),(29,5),(11,4),(15,4),(20,1),(23,1)] in
let docids:[Int] = [0,0,0,0,0,0,1,1,1,1,1,2,2,2,3,3,3,3,3,3,3,3,4,4,4,4,4,4,5,5,5,5,5,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,8,8,8,8,8,9,9,9,9,9,10,10,10,10,10,10,10,11,11,11,11,12,12,12,12,13,13,13,13,13,14,14,14,14,15,15,15,15,15,15,16,16,16,16,16,17,17,17,17,17,18,18,18,18,18,18,18,19,19,19,19,19,19,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,23,23,23,24,24,24,24] in
let z = map (lam w.
	let word = get docs w in
	let z = assume (Multinomial word.1 (get theta (get docids w))) in
	iteri (lam z. lam e. observe (oneHotEncoding vocabsize word.0 e) (Multinomial e (get phi z))) z;
 z)(range 0 (length docs) 1) in 
let str = foldl (lam acc. lam e. join [acc,float2string e," "]) "" (get theta 0) in

                       let str = foldl (lam acc. lam e. join [acc,float2string e," "]) str (get theta 1) in

                       let str = foldl (lam acc. lam e. join [acc,float2string e," "]) str (get theta 2) in

                       let str = foldl (lam acc. lam e. join [acc,float2string e," "]) str (get phi 0) in

                       foldl (lam acc. lam e. join [acc,float2string e," "]) str (get phi 1) 
